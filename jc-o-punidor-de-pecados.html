<!DOCTYPE html>
<html>
<head>
    <title>JC o punidor de pecados</title>
    <meta charset="UTF-8">
    <script src="spritesheet_jc.js"></script>
    <script src="animacao.js"></script>
    <script src="teclado.js"></script>
    <script src="aguabenta.js"></script>
    <script src="jc.js"></script>
    <link rel="stylesheet" href="src/style.css">
</head>
<body>
    <canvas id="canvas_jc" width="1000" height="500"></canvas>
    <script>
        var canvas = document.getElementById('canvas_jc');
        var context = canvas.getContext('2d');

        // Constantes de Tecla (como antes)
        var SETA_CIMA = 38;
        var ESPACO = 32;
        var TECLA_W = 87;
        // ... outras constantes ...

        var teclado = new Teclado(document);
        var animacao = new Animacao(context, canvas);

        var imgJC = new Image();
        var imgCoracao = new Image();

        var imagensParaCarregar = 2;
        var imagensCarregadas = 0;

        function imagemCarregada() {
            imagensCarregadas++;
            // Log para ver o status de carregamento
            console.log('Uma imagem tentou carregar. Total agora:', imagensCarregadas, 'de', imagensParaCarregar);

            if (this.src.includes('vida-coracao') && this.naturalHeight === 0) {
                console.error('IMAGEM DO CORAÇÃO PARECE NÃO TER CARREGADO CORRETAMENTE (altura 0):', this.src);
            } else if (this.src.includes('JC_alpha') && this.naturalHeight === 0) {
                console.error('IMAGEM DO JC PARECE NÃO TER CARREGADO CORRETAMENTE (altura 0):', this.src);
            }


                if (imagensCarregadas === imagensParaCarregar) {
                    console.log("TODAS AS IMAGENS REGISTRADAS COMO CARREGADAS. Verificando se realmente carregaram...");

                    let jcRealmenteCarregada = imgJC.complete && imgJC.naturalHeight !== 0;
                    let coracaoRealmenteCarregado = imgCoracao.complete && imgCoracao.naturalHeight !== 0;

                    if(jcRealmenteCarregada && coracaoRealmenteCarregado){
                        console.log("CONFIRMADO: Imagens JC e Coração carregadas com sucesso. Iniciando animação.");
                        animacao.imgCoracaoHUD = imgCoracao;
                        animacao.mundoLargura = 2000;
                        animacao.ligar();
                    } else {
                        if(!jcRealmenteCarregada) console.error("ERRO FATAL: Imagem JC não carregou de verdade.");
                        if(!coracaoRealmenteCarregado) console.error("ERRO FATAL: Imagem do Coração não carregou de verdade.");
                    }
                }
            }

        var TECLA_P = 80;
            teclado.disparou(TECLA_P, function() {
                // --- NOVO LOG AQUI ---
                if (jc) { // Verifica se jc existe primeiro
                    console.log('[HTML - Tecla P] Verificando JC. Vidas:', jc.vidas, 'Esta Morto:', jc.estaMorto, 'Resultado de estaVivo():', jc.estaVivo());
                } else {
                    console.error('[HTML - Tecla P] Objeto jc NÃO existe neste ponto!');
                    return; // Sai se jc não existe
                }
                // ---------------------

                if (jc && typeof jc.estaVivo === 'function' && jc.estaVivo()) {
                    console.log('[HTML - Tecla P] Condição VERDADEIRA. Chamando jc.sofrerDano(1)');
                    jc.sofrerDano(1);
                } else if (jc) { // Esta é a linha que está sendo executada segundo seu log anterior
                    console.log('[HTML - Tecla P] Condição FALSA. Mensagem: JC já morreu ou não pode sofrer dano.');
                }
            });

        imgJC.onload = imagemCarregada;
        imgCoracao.onload = imagemCarregada;

        imgJC.onerror = function() {
            console.error("ERRO no imgJC.onerror: Falha ao carregar IMAGEM JC! Caminho:", imgJC.src);
            imagemCarregada(); // Chama para não bloquear o contador, mas o erro acima indicará o problema
        };
        imgCoracao.onerror = function() {
            console.error("ERRO no imgCoracao.onerror: Falha ao carregar IMAGEM DO CORAÇÃO! Caminho:", imgCoracao.src);
            imagemCarregada(); // Chama para não bloquear o contador
        };

        console.log('Definindo src para imgJC:', 'img/JC_alpha.png');
        imgJC.src = 'img/JC_alpha.png';
        console.log('Definindo src para imgCoracao:', 'img/vida-coracao.png'); // CONFIRME ESTE CAMINHO
        imgCoracao.src = 'img/vida-coracao.png'; // CONFIRME ESTE CAMINHO

        var jc = new JC(context, teclado, imgJC, animacao, canvas);
        animacao.novoSprite(jc, true);

        // Configurações de teclado (como antes)
        teclado.disparou(SETA_CIMA, jc.pular.bind(jc));
        teclado.disparou(TECLA_W, jc.pular.bind(jc));
        teclado.disparou(ESPACO, jc.atirar.bind(jc));

    </script>
</body>
</html>