<!DOCTYPE html>
<html>
<head>
    <title>Teste de Teclado e Pulo do Sonic</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #statusSonic {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            font-size: 1.2em;
        }
        .log { color: #777; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>Teste de Pulo do Sonic</h1>
    <p>Pressione as teclas <strong>SETA PARA CIMA</strong> ou <strong>ESPAÇO</strong> para fazer o Sonic "pular".</p>
    <p>Abra o console do navegador (F12) para ver os logs detalhados.</p>
    <div id="statusSonic">Sonic Y: 200</div>

    <script>
        console.log('%c--- Iniciando Teste de Pulo ---', 'font-weight:bold; color:blue;');

        // --- Definições de Teclas ---
        var SETA_CIMA = 38;
        var ESPACO = 32;
        // (Outras teclas como SETA_ESQUERDA, SETA_DIREITA podem ser adicionadas se necessário para outros testes)

        // --- Classe Teclado (Sua versão, com logs adicionais) ---
        function Teclado(elemento) {
            this.elemento = elemento;
            this.disparadas = [];      // Controla se uma ação já foi disparada para uma tecla pressionada
            this.funcoesDisparo = [];  // Armazena as funções de callback para cada tecla

            var teclado_self = this; // Referência ao objeto Teclado para usar dentro dos listeners
            console.log('[Teclado] Instância criada. Elemento alvo:', elemento);

            elemento.addEventListener('keydown', function(evento) {
                var tecla = evento.keyCode; // Código da tecla pressionada
                // console.log('[Teclado] Evento: keydown - Tecla Pressionada:', tecla);

                // Verifica se existe uma função de disparo para esta tecla E se ela ainda não foi disparada nesta sessão de pressionamento
                if (teclado_self.funcoesDisparo[tecla] && !teclado_self.disparadas[tecla]) {
                    console.log('%c[Teclado] Disparando ação para tecla: ' + tecla, 'color:green');
                    teclado_self.disparadas[tecla] = true;  // Marca como disparada para evitar repetição enquanto pressionada
                    teclado_self.funcoesDisparo[tecla]();   // Executa a função de callback registrada
                }
            });

            elemento.addEventListener('keyup', function(evento) {
                var tecla = evento.keyCode;
                // console.log('[Teclado] Evento: keyup - Tecla Solta:', tecla);
                teclado_self.disparadas[tecla] = false; // Permite que a ação seja disparada novamente no próximo keydown
            });
        }

        Teclado.prototype.disparou = function(tecla, callback) {
            console.log('[Teclado] Registrando callback para tecla:', tecla);
            this.funcoesDisparo[tecla] = callback; // Associa a função de callback à tecla
        };
        // (O método 'pressionada' não é usado neste exemplo mínimo, mas pode ser mantido na sua classe completa)
        // Teclado.prototype.pressionada = function(tecla) { return this.pressionadas[tecla]; };


        // --- Classe Sonic Simplificada (com foco no pulo e feedback visual) ---
        function Sonic() {
            this.posicaoChao = 200;
            this.y = this.posicaoChao;
            this.alturaPulo = 70;
            this.estaPulando = false;
            this.duracaoPuloMs = 600; // Duração do pulo em milissegundos

            this.statusElement = document.getElementById('statusSonic'); // Elemento no HTML para mostrar o status
            this.atualizarStatusVisual();
            console.log('[Sonic] Instância criada. Y inicial:', this.y);
        }

        Sonic.prototype.pular = function() {
            console.log('%c[Sonic] Tentativa de pulo. estaPulando: ' + this.estaPulando, 'color:purple; font-weight:bold;');

            if (!this.estaPulando) {
                this.estaPulando = true;
                this.y -= this.alturaPulo; // Move para cima (diminui Y)
                this.atualizarStatusVisual("Pulando...");
                console.log('[Sonic] PULOU! Novo Y:', this.y);

                // Simula o retorno ao chão
                setTimeout(() => {
                    this.y = this.posicaoChao;
                    this.estaPulando = false;
                    this.atualizarStatusVisual("No chão.");
                    console.log('[Sonic] Voltou ao chão. Y:', this.y);
                }, this.duracaoPuloMs);
            } else {
                console.log('[Sonic] Já está pulando, não pode pular novamente agora.');
            }
        };

        Sonic.prototype.atualizarStatusVisual = function(acaoExtra = "") {
            if (this.statusElement) {
                this.statusElement.textContent = 'Sonic Y: ' + this.y + (this.estaPulando ? ' (Pulando)' : ' (No Chão)') + ' ' + acaoExtra;
            }
        };


        // --- Lógica Principal de Inicialização (Como seu main.js faria) ---
        console.log('[Main] Iniciando configuração...');

        // 1. Cria a instância do Teclado, escutando eventos no documento inteiro
        var meuTeclado = new Teclado(document);

        // 2. Cria a instância do Sonic
        var meuSonic = new Sonic();

        // 3. Configura as ações para as teclas SETA_CIMA e ESPACO
        //    Quando a tecla for disparada, chamará o método 'pular' da instância 'meuSonic'
        meuTeclado.disparou(SETA_CIMA, function() {
            console.log('[Main] Callback para SETA_CIMA ativado. Chamando meuSonic.pular().');
            meuSonic.pular();
        });

        meuTeclado.disparou(ESPACO, function() {
            console.log('[Main] Callback para ESPACO ativado. Chamando meuSonic.pular().');
            meuSonic.pular();
        });

        console.log('[Main] Configuração concluída. O sistema está pronto para receber inputs de teclado.');
        console.log('%c--- Pressione SETA PARA CIMA ou ESPAÇO ---', 'font-weight:bold; color:blue;');

    </script>
</body>
</html>